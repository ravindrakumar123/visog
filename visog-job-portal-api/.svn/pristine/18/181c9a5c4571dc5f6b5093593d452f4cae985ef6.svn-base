-- CLEAN UP OLD DATABASE

DROP TABLE LOGIN_MASTER;
DROP TABLE USER_OTPS;
DROP TABLE USER_SECURITY_QUESTIONS;
DROP TABLE USER_XFACTORS;
DROP TABLE USER_PASSWORDS;
DROP TABLE USER_OTP_PREFERENCES;
DROP TABLE UMGMT_USERS;
DROP TABLE ROLE_PREVILEGE_LINKS;
DROP TABLE ACCESS_LINKS;
DROP TABLE SECURITY_QUESTIONS;
DROP TABLE PASSWORD_RULES;
DROP TABLE ROLES;
DROP TABLE INSTITUTE_PARAMS;
DROP TABLE INST_MASTER;

-- CLEAN UP OLD SEQUENCES

DROP SEQUENCE ACCESS_LINKS_SEQ;
DROP SEQUENCE INST_MASTER_SEQ;
DROP SEQUENCE ROLES_SEQ;
DROP SEQUENCE UMGMT_USERS_SEQ;
DROP SEQUENCE LOGIN_MASTER_SEQ;
DROP SEQUENCE USER_XFACTORS_SEQ;
DROP SEQUENCE ROLE_PREVILEGE_LINKS_SEQ;
DROP SEQUENCE SECURITY_QUESTIONS_SEQ;
DROP SEQUENCE USER_SECURITY_QUESTIONS_SEQ;
DROP SEQUENCE USER_OTPS_SEQ;
DROP SEQUENCE PASSWORD_RULES_SEQ;
DROP SEQUENCE USER_PASSWORDS_SEQ;
DROP SEQUENCE USER_OTP_PREFERENCES_SEQ;
DROP SEQUENCE INSTITUTE_PARAMS_SEQ;

-- CREATE NEW SEQUENCES

CREATE SEQUENCE ACCESS_LINKS_SEQ;
CREATE SEQUENCE INST_MASTER_SEQ;
CREATE SEQUENCE ROLES_SEQ;
CREATE SEQUENCE UMGMT_USERS_SEQ;
CREATE SEQUENCE LOGIN_MASTER_SEQ;
CREATE SEQUENCE USER_XFACTORS_SEQ;
CREATE SEQUENCE ROLE_PREVILEGE_LINKS_SEQ;
CREATE SEQUENCE SECURITY_QUESTIONS_SEQ;
CREATE SEQUENCE USER_SECURITY_QUESTIONS_SEQ;
CREATE SEQUENCE USER_OTPS_SEQ;
CREATE SEQUENCE PASSWORD_RULES_SEQ;
CREATE SEQUENCE USER_PASSWORDS_SEQ;
CREATE SEQUENCE USER_OTP_PREFERENCES_SEQ;
CREATE SEQUENCE INSTITUTE_PARAMS_SEQ;

-- CREATE NEW DATABASE

CREATE TABLE "INST_MASTER"
  (
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "NAME" 				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ADDR1" 			VARCHAR2(200 BYTE),
    "ADDR2" 			VARCHAR2(200 BYTE),
    "CITY" 				VARCHAR2(200 BYTE),
    "STATE" 			VARCHAR2(200 BYTE),
    "RT_NUM" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ZIP" 				VARCHAR2(200 BYTE),
    CONSTRAINT "INST_PK" PRIMARY KEY ("INST_ID"), 
    CONSTRAINT "INST_RT_UNQ" UNIQUE ("RT_NUM")
  );
  
CREATE TABLE "ACCESS_LINKS"
  (
    "ACCESS_LINK_ID"   	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "NAME" 				VARCHAR2(400 BYTE) NOT NULL ENABLE,
    "DISPLAY_NAME" 		VARCHAR2(400 BYTE) NOT NULL ENABLE,
    "DESCRIPTION" 		VARCHAR2(400 BYTE),
    "IS_OTP_REQ"		VARCHAR2(1 BYTE) NOT NULL ENABLE,
    "OTP_MEDIA"			VARCHAR2(50 BYTE) NOT NULL ENABLE,
    "PARENT_ID"   		VARCHAR2(200 BYTE),
    CONSTRAINT "ACC_LN_PK" PRIMARY KEY ("ACCESS_LINK_ID"), 
    CONSTRAINT "ACC_LN_NAME_UNQ" UNIQUE ("INST_ID", "NAME"), 
    CONSTRAINT "ACC_LN_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
    CONSTRAINT "ACC_LN_ACC_LN_ID_FK" FOREIGN KEY ("PARENT_ID") REFERENCES "ACCESS_LINKS" ("ACCESS_LINK_ID") ENABLE
  );
  
CREATE TABLE "ROLES"
  (
    "ROLE_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ROLE_NAME" 		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "DESCRIPTION"  		VARCHAR2(200 BYTE),
    "MULTIPLE_LOGIN" 	VARCHAR2(1 BYTE) NOT NULL ENABLE,
    CONSTRAINT "ROLES_PK" PRIMARY KEY ("ROLE_ID"), 
    CONSTRAINT "ROLES_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE
  );
  
CREATE TABLE "UMGMT_USERS"
  (
    "USER_ID"   				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "USER_NAME" 				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "FIRST_NAME"  				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "MIDDLE_NAME"  				VARCHAR2(200 BYTE),
    "LAST_NAME"  				VARCHAR2(200 BYTE),
    "PASSWORD" 					VARCHAR2(400 BYTE) NOT NULL ENABLE,
    "IS_TEMPORARY_PASSWORD" 	VARCHAR2(1 BYTE) NOT NULL ENABLE,
    "EMAIL_ID" 					VARCHAR2(400 BYTE) NOT NULL ENABLE,
    "MOBILE_NO"					VARCHAR2(400 BYTE) NOT NULL ENABLE,
    "SECONDARY_EMAIL_ID" 		VARCHAR2(400 BYTE),
    "SECONDARY_MOBILE_NO" 		VARCHAR2(400 BYTE),
    "STATUS" 					VARCHAR2(400 BYTE) NOT NULL ENABLE,
    "ROLE_ID" 					VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "DEFAULT_ACCESS_LINK_ID" 	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "CREATED_ON"   				TIMESTAMP NOT NULL ENABLE,
    "UPDATED_ON"   				TIMESTAMP,
    CONSTRAINT "USER_PK" PRIMARY KEY ("USER_ID"), 
    CONSTRAINT "USER_EMAIL_UNQ" UNIQUE ("EMAIL_ID"), 
    CONSTRAINT "USER_UNAME_UNQ" UNIQUE ("USER_NAME"), 
    CONSTRAINT "USERS_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
    CONSTRAINT "USERS_ROLE_ID_FK" FOREIGN KEY ("ROLE_ID") REFERENCES "ROLES" ("ROLE_ID") ENABLE, 
    CONSTRAINT "USERS_ACCESSLINK_ID_FK" FOREIGN KEY ("DEFAULT_ACCESS_LINK_ID") REFERENCES "ACCESS_LINKS" ("ACCESS_LINK_ID") ENABLE
  );
  
CREATE TABLE "LOGIN_MASTER"
  (
    "LOGIN_MASTER_ID"   VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "USER_ID" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "SUCCESS_IND" 		VARCHAR2(1 BYTE) NOT NULL ENABLE,
    "IN_OUT_DATE" 		TIMESTAMP,
    "IN_OUT_IND"     	VARCHAR2(1 BYTE),
    "SESSION_TIME" 		TIMESTAMP,
    "LAST_LOGIN_DATE"   TIMESTAMP,
    "CREATED_ON"   		TIMESTAMP NOT NULL ENABLE,
    CONSTRAINT "LOGIN_MASTER_PK" PRIMARY KEY ("LOGIN_MASTER_ID"), 
    CONSTRAINT "LOGIN_MASTER_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE,
    CONSTRAINT "LOGIN_MASTER_USER_ID_FK" FOREIGN KEY ("USER_ID") REFERENCES "UMGMT_USERS" ("USER_ID") ENABLE
  );
  
CREATE TABLE "USER_XFACTORS"
  (
    "XFACTOR_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "USER_ID" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "XFACTOR_VALUE" 	VARCHAR2(400 BYTE) NOT NULL ENABLE,
    CONSTRAINT "XFACTOR_PK" PRIMARY KEY ("XFACTOR_ID"), 
    CONSTRAINT "XFACTORS_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
   	CONSTRAINT "XFACTORS_USER_ID_FK" FOREIGN KEY ("USER_ID") REFERENCES "UMGMT_USERS" ("USER_ID") ENABLE
  );
  
CREATE TABLE "ROLE_PREVILEGE_LINKS"
  (
    "ROLE_PREVILEGE_LINK_ID"   	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ACCESS_LINK_ID"   			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ORDER_NUM"					NUMBER NOT NULL ENABLE,
    "ROLE_ID" 					VARCHAR2(200 BYTE) NOT NULL ENABLE,
    CONSTRAINT "ROL_PR_LN_PK" PRIMARY KEY ("ROLE_PREVILEGE_LINK_ID"), 
    CONSTRAINT "ROL_PR_LN_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
    CONSTRAINT "ROL_PR_LN_ROLE_ID_FK" FOREIGN KEY ("ROLE_ID") REFERENCES "ROLES" ("ROLE_ID") ENABLE, 
    CONSTRAINT "ROL_PR_LN_ACCLN_ID_FK" FOREIGN KEY ("ACCESS_LINK_ID") REFERENCES "ACCESS_LINKS" ("ACCESS_LINK_ID") ENABLE
  );
  
CREATE TABLE "SECURITY_QUESTIONS"
  (
    "QUESTIONS_ID"   	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "NAME"   			VARCHAR2(1000 BYTE) NOT NULL ENABLE,
    "CATEGORY"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    CONSTRAINT "SEC_Q_PK" PRIMARY KEY ("QUESTIONS_ID"), 
    CONSTRAINT "SEC_Q_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE
  );
  
CREATE TABLE "USER_SECURITY_QUESTIONS"
  (
    "USER_SECURITY_QUESTION_ID"   	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "USER_ID" 						VARCHAR2(200 BYTE) NOT NULL ENABLE, 
    "QUESTIONS_ID"   				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ANSWER"   						VARCHAR2(1000 BYTE) NOT NULL ENABLE,
    "INST_ID"   					VARCHAR2(200 BYTE) NOT NULL ENABLE,
    CONSTRAINT "USR_SEC_Q_PK" PRIMARY KEY ("USER_SECURITY_QUESTION_ID"), 
    CONSTRAINT "USR_SEC_Q_UNQ_UQ" UNIQUE ("INST_ID", "USER_ID", "QUESTIONS_ID"), 
    CONSTRAINT "USR_SEC_Q_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
    CONSTRAINT "USR_SEC_Q_UID_FK" FOREIGN KEY ("USER_ID") REFERENCES "UMGMT_USERS" ("USER_ID") ENABLE, 
    CONSTRAINT "USR_SEC_Q_QID_FK" FOREIGN KEY ("QUESTIONS_ID") REFERENCES "SECURITY_QUESTIONS" ("QUESTIONS_ID") ENABLE
  );
  
CREATE TABLE "USER_OTPS"
  (
    "USER_OTP_ID"   	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "USER_ID" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "VALUE" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ACTIVITY" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "STATUS" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "GENERATED_ON"  	TIMESTAMP NOT NULL ENABLE,
    CONSTRAINT "USER_OTP_PK" PRIMARY KEY ("USER_OTP_ID"), 
    CONSTRAINT "USER_OTP_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
   	CONSTRAINT "USER_OTP_USER_ID_FK" FOREIGN KEY ("USER_ID") REFERENCES "UMGMT_USERS" ("USER_ID") ENABLE
  );
  
CREATE TABLE "PASSWORD_RULES"
  (
    "PASSWORD_RULE_ID"   			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID" 		  				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ROLE_ID"	 					VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "PASSWORD_RULE_NAME" 			VARCHAR2(200 BYTE),
    "PASSWORD_EXPIRY_DAYS"  		NUMBER(10,0),
    "CHECK_LAST_PASSWORD"	 		NUMBER(10,0),
    "MINIMUM_LENGTH" 				NUMBER(10,0),
    "MINIMUM_LOWER_CASE_CHARS" 		NUMBER(10,0),
    "MINIMUM_NUMERIC_CHARS" 		NUMBER(10,0),
    "MINIMUM_SPECIAL_CHARS" 		NUMBER(10,0),
    "MINIMUM_UPPER_CASE_CHARS" 		NUMBER(10,0),
    "RESTRICT_NAME_IN_PASSWORD" 	VARCHAR2(1 BYTE),
    "RESTRICT_PASSWORD_KEYWORDS" 	VARCHAR2(1 BYTE),
    "RESTRICT_USERID_IN_PASSWORD" 	VARCHAR2(1 BYTE),
    "PASSWORD_KEYWORDS" 			VARCHAR2(1000 BYTE),
    "FAILED_LOGIN_ATTEMPTS" 		NUMBER(10,0),
    "EXPIRY_WARNING_AFTER" 			NUMBER(10,0), 
    CONSTRAINT "PWD_RL_PK" PRIMARY KEY ("PASSWORD_RULE_ID"), 
    CONSTRAINT "PWD_RL_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE,  
    CONSTRAINT "PWD_RL_ROLE_ID_FK" FOREIGN KEY ("ROLE_ID") REFERENCES "ROLES" ("ROLE_ID") ENABLE
  );
  
CREATE TABLE "USER_PASSWORDS"
  (
    "USER_PASSWORD_ID"  VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "USER_ID" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   		VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "PASSWORD" 			VARCHAR2(400 BYTE) NOT NULL ENABLE,
    "CREATED_ON"   		TIMESTAMP NOT NULL ENABLE,
    CONSTRAINT "USER_PWD_PK" PRIMARY KEY ("USER_PASSWORD_ID"), 
    CONSTRAINT "USER_PWD_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
   	CONSTRAINT "USER_PWD_USER_ID_FK" FOREIGN KEY ("USER_ID") REFERENCES "UMGMT_USERS" ("USER_ID") ENABLE
  );
  
CREATE TABLE "USER_OTP_PREFERENCES"
  (
    "USER_OTP_PREFERENCE_ID"  	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "USER_ID" 					VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"   				VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "ACCESS_LINK_ID"   			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "IS_OTP_REQ"				VARCHAR2(1 BYTE) NOT NULL ENABLE,
    "OTP_MEDIA"					VARCHAR2(50 BYTE) NOT NULL ENABLE,
    CONSTRAINT "UOP_PK" PRIMARY KEY ("USER_OTP_PREFERENCE_ID"), 
    CONSTRAINT "UOP_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE, 
   	CONSTRAINT "UOP_USER_ID_FK" FOREIGN KEY ("USER_ID") REFERENCES "UMGMT_USERS" ("USER_ID") ENABLE, 
    CONSTRAINT "UOP_ACCLN_ID_FK" FOREIGN KEY ("ACCESS_LINK_ID") REFERENCES "ACCESS_LINKS" ("ACCESS_LINK_ID") ENABLE
  );
  
CREATE TABLE "INSTITUTE_PARAMS"
  (
    "INSTITUTE_PARAM_ID"   	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "INST_ID"           	VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "PARAM_NAME" 			VARCHAR2(200 BYTE) NOT NULL ENABLE,
    "PARAM_VALUE" 			VARCHAR2(800 BYTE) NOT NULL ENABLE,
     CONSTRAINT "INST_PRM_PK" PRIMARY KEY ("INSTITUTE_PARAM_ID"), 
     CONSTRAINT "INST_PRM_PNM_UNQ_UQ" UNIQUE ("INST_ID", "PARAM_NAME"), 
     CONSTRAINT "INST_PRM_INST_ID_FK" FOREIGN KEY ("INST_ID") REFERENCES "INST_MASTER" ("INST_ID") ENABLE
  );
  
 
